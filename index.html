<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Painel IoT — Controle de Cargas</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  /* ======== DESIGN ENTERPRISE ======== */
  :root {
    --primary: #1976d2;
    --primary-hover: #0e63b8;
    --primary-light: #e3f2fd;

    --bg: #f4f6f8;
    --card: #ffffff;
    --border: #e0e0e0;

    --text: #1f1f1f;
    --text-light: #5f6368;

    --success: #2e7d32;
    --danger: #c62828;

    --radius: 12px;
    --shadow: 0 4px 12px rgba(0,0,0,0.06);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: "Inter", sans-serif;
  }

  body {
    background: var(--bg);
    display: flex;
    height: 100vh;
    overflow: hidden;
  }

  /* ===== SIDEBAR ===== */
  .sidebar {
    width: 250px;
    background: #fff;
    border-right: 1px solid var(--border);
    padding: 24px 18px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    box-shadow: var(--shadow);
  }

  .sidebar h2 {
    font-size: 20px;
    font-weight: 700;
    color: var(--primary);
  }

  .nav-item {
    padding: 12px 14px;
    border-radius: var(--radius);
    cursor: pointer;
    color: var(--text-light);
    font-size: 15px;
    transition: 0.2s ease;
  }

  .nav-item:hover,
  .nav-item.active {
    background: var(--primary-light);
    color: var(--primary);
  }

  /* ===== CONTENT ===== */
  .content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  header {
    background: #fff;
    padding: 20px 30px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  header h1 {
    font-size: 22px;
    font-weight: 600;
  }

  /* ===== MAIN AREA ===== */
  .main-content {
    flex: 1;
    padding: 32px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 28px;
  }

  /* ===== CARD PADRÃO ===== */
  .card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 22px;
    box-shadow: var(--shadow);
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .card-title {
    font-size: 17px;
    font-weight: 600;
  }

  /* ===== SWITCH ===== */
  .switch {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .toggle {
    width: 50px;
    height: 26px;
    background: #cfcfcf;
    border-radius: 50px;
    cursor: pointer;
    position: relative;
    transition: background 0.25s ease;
  }

  .toggle-circle {
    width: 22px;
    height: 22px;
    background: #fff;
    border-radius: 50%;
    position: absolute;
    top: 2px;
    left: 2px;
    transition: transform 0.25s ease;
  }

  .toggle.on {
    background: var(--primary);
  }

  .toggle.on .toggle-circle {
    transform: translateX(24px);
  }

  /* ===== STATUS ===== */
  .status {
    font-size: 14px;
    font-weight: 600;
    padding: 6px 12px;
    border-radius: 6px;
    width: fit-content;
  }

  .status.on {
    background: var(--primary-light);
    color: var(--primary);
  }

  .status.off {
    background: #ffebee;
    color: var(--danger);
  }

  /* ===== BUTTONS ===== */
  .btn {
    padding: 12px 18px;
    font-size: 14px;
    font-weight: 600;
    border-radius: var(--radius);
    border: none;
    cursor: pointer;
    transition: 0.2s;
  }

  .btn-primary {
    background: var(--primary);
    color: #fff;
  }

  .btn-primary:hover {
    background: var(--primary-hover);
  }

  .btn-on {
    background: var(--success);
    color: #fff;
  }

  .btn-on:hover {
    background: #1b5e20;
  }

  .btn-off {
    background: var(--danger);
    color: #fff;
  }

  .btn-off:hover {
    background: #b71c1c;
  }

  .controls {
    display: flex;
    gap: 10px;
  }

  /* ===== GRID ===== */
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
    gap: 24px;
  }

  /* ===== CONFIG SECTION ===== */
  .config-section {
    background: var(--card);
    border: 1px solid var(--border);
    padding: 24px;
    border-radius: var(--radius);
    max-width: 420px;
    box-shadow: var(--shadow);
  }

  .config-section h3 {
    font-size: 18px;
    margin-bottom: 16px;
  }

  .input-group {
    display: flex;
    gap: 10px;
    margin-bottom: 10px;
  }

  .config-section input {
    flex: 1;
    padding: 12px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 15px;
  }

  /* ===== CHART ===== */
  .chart-container {
    background: var(--card);
    padding: 20px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    height: 320px;
    box-shadow: var(--shadow);
  }

  .chart-container h3 {
    margin-bottom: 16px;
    font-size: 18px;
  }

  /* ===== INFO SECTION ===== */
  .info-section {
    background: var(--card);
    padding: 34px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    box-shadow: var(--shadow);
    line-height: 1.65;
  }

  .info-section h2 {
    color: var(--primary);
    margin-bottom: 20px;
    font-size: 24px;
  }

  .info-section h3 {
    color: var(--text);
    margin: 25px 0 15px 0;
    font-size: 18px;
  }

  .info-section p {
    margin-bottom: 15px;
    color: var(--text-light);
  }

  .info-section ul {
    margin-left: 20px;
    margin-bottom: 20px;
  }

  .info-section li {
    margin-bottom: 8px;
    color: var(--text-light);
  }

  .developers {
    background: var(--primary-light);
    padding: 20px;
    border-radius: var(--radius);
    border-left: 4px solid var(--primary);
    margin-top: 25px;
  }

  .developers h4 {
    color: var(--primary);
    margin-bottom: 10px;
  }

  /* RESPONSIVO */
  @media (max-width: 768px) {
    body {
      flex-direction: column;
    }
    
    .sidebar {
      width: 100%;
      flex-direction: row;
      overflow-x: auto;
      padding: 16px;
    }
    
    .sidebar h2 {
      display: none;
    }
    
    .nav-item {
      white-space: nowrap;
    }
    
    .grid {
      grid-template-columns: 1fr;
    }
    
    .config-section {
      max-width: 100%;
    }
    
    .main-content {
      padding: 20px;
    }
  }
</style>
</head>
<body>
  <!-- SIDEBAR -->
  <div class="sidebar">
    <h2>Painel IoT</h2>
    <div class="nav-item active" onclick="showSection('dashboard')">Dashboard</div>
    <div class="nav-item" onclick="showSection('cargas')">Cargas</div>
    <div class="nav-item" onclick="showSection('graficos')">Gráficos</div>
    <div class="nav-item" onclick="showSection('logs')">Logs</div>
    <div class="nav-item" onclick="showSection('informacoes')">Informações</div>
    <div class="nav-item" onclick="showSection('configuracoes')">Configurações</div>
  </div>

  <!-- MAIN AREA -->
  <div class="content">
    <header>
      <h1>Controle Inteligente de Cargas</h1>
    </header>

    <div class="main-content">
      <!-- SEÇÃO DASHBOARD -->
      <div id="dashboard" class="section active">
        <!-- Configuração IP -->
        <div class="config-section">
          <h3>Configurar IP do Arduino</h3>
          <div class="input-group">
            <input id="arduinoIP" type="text" placeholder="Ex: 192.168.1.77" />
            <button class="btn btn-primary" onclick="salvarIP()">Guardar IP</button>
          </div>
        </div>

        <!-- Grid de Cargas -->
        <div class="grid">
          <!-- CARD 1 -->
          <div class="card">
            <div class="card-title">Lâmpada 1</div>
            <span class="status off">OFF</span>
            <div class="switch">
              <small>Estado</small>
              <div class="toggle" onclick="toggleSwitch(this, 1)">
                <div class="toggle-circle"></div>
              </div>
            </div>
            <div class="controls">
              <button class="btn btn-on" onclick="controlarLampada(1, true)">Ligar</button>
              <button class="btn btn-off" onclick="controlarLampada(1, false)">Desligar</button>
            </div>
          </div>

          <!-- CARD 2 -->
          <div class="card">
            <div class="card-title">Lâmpada 2</div>
            <span class="status off">OFF</span>
            <div class="switch">
              <small>Estado</small>
              <div class="toggle" onclick="toggleSwitch(this, 2)">
                <div class="toggle-circle"></div>
              </div>
            </div>
            <div class="controls">
              <button class="btn btn-on" onclick="controlarLampada(2, true)">Ligar</button>
              <button class="btn btn-off" onclick="controlarLampada(2, false)">Desligar</button>
            </div>
          </div>

          <!-- CARD 3 -->
          <div class="card">
            <div class="card-title">Lâmpada 3</div>
            <span class="status off">OFF</span>
            <div class="switch">
              <small>Estado</small>
              <div class="toggle" onclick="toggleSwitch(this, 3)">
                <div class="toggle-circle"></div>
              </div>
            </div>
            <div class="controls">
              <button class="btn btn-on" onclick="controlarLampada(3, true)">Ligar</button>
              <button class="btn btn-off" onclick="controlarLampada(3, false)">Desligar</button>
            </div>
          </div>

          <!-- CARD 4 -->
          <div class="card">
            <div class="card-title">Lâmpada 4</div>
            <span class="status off">OFF</span>
            <div class="switch">
              <small>Estado</small>
              <div class="toggle" onclick="toggleSwitch(this, 4)">
                <div class="toggle-circle"></div>
              </div>
            </div>
            <div class="controls">
              <button class="btn btn-on" onclick="controlarLampada(4, true)">Ligar</button>
              <button class="btn btn-off" onclick="controlarLampada(4, false)">Desligar</button>
            </div>
          </div>
        </div>

        <!-- Gráfico -->
        <div class="chart-container">
          <h3>Consumo de Energia</h3>
          <canvas id="chart"></canvas>
        </div>
      </div>

      <!-- OUTRAS SEÇÕES (inicialmente ocultas) -->
      <div id="cargas" class="section" style="display: none;">
        <h2>Gestão de Cargas</h2>
        <p>Interface para gestão detalhada das cargas...</p>
      </div>

      <div id="graficos" class="section" style="display: none;">
        <h2>Gráficos Detalhados</h2>
        <p>Visualizações avançadas de consumo...</p>
      </div>

      <div id="logs" class="section" style="display: none;">
        <h2>Logs do Sistema</h2>
        <p>Histórico de atividades e eventos...</p>
      </div>

      <!-- SEÇÃO INFORMAÇÕES -->
      <div id="informacoes" class="section" style="display: none;">
        <div class="info-section">
          <h2>Sobre o Projeto</h2>
          
          <h3>O que é este sistema?</h3>
          <p>Este é um sistema completo de controle de cargas IoT desenvolvido para automatizar e gerenciar remotamente até 4 lâmpadas ou dispositivos elétricos de 220V através de uma interface web moderna e intuitiva.</p>

          <h3>Como funciona?</h3>
          <p>O sistema utiliza uma arquitetura cliente-servidor onde:</p>
          <ul>
            <li><strong>Interface Web:</strong> Permite controlar os dispositivos através de qualquer navegador ou dispositivo móvel</li>
            <li><strong>Arduino com Ethernet:</strong> Atua como servidor local recebendo comandos via HTTP</li>
            <li><strong>Módulo de Relés:</strong> Interface segura entre o Arduino (5V) e as cargas elétricas (220V)</li>
            <li><strong>Protocolo HTTP:</strong> Comunicação simples e eficiente na rede local</li>
          </ul>

          <h3>Para que serve?</h3>
          <p>Este sistema é ideal para:</p>
          <ul>
            <li><strong>Automação Residencial:</strong> Controlar iluminação de forma remota</li>
            <li><strong>Eficiência Energética:</strong> Gerenciar consumo elétrico inteligentemente</li>
            <li><strong>Segurança:</strong> Simular presença através de acionamento programado</li>
            <li><strong>Controle Empresarial:</strong> Gerenciar iluminação de escritórios e espaços comerciais</li>
            <li><strong>Educação:</strong> Aprender sobre IoT, eletrônica e programação</li>
          </ul>

          <h3>Como usar?</h3>
          <p><strong>Configuração Inicial:</strong></p>
          <ul>
            <li>Conecte o Arduino à rede Ethernet</li>
            <li>Configure o IP do Arduino na seção "Dashboard"</li>
            <li>Conecte as lâmpadas aos relés conforme o diagrama elétrico</li>
          </ul>

          <p><strong>Uso Diário:</strong></p>
          <ul>
            <li>Acesse a interface através de qualquer dispositivo na mesma rede</li>
            <li>Use os botões "Ligar/Desligar" ou os switches para controlar cada carga</li>
            <li>Monitore o consumo através dos gráficos</li>
            <li>Consulte o histórico de operações nos logs</li>
          </ul>

          <h3>Características Técnicas</h3>
          <ul>
            <li>Controle de até 4 cargas independentes</li>
            <li>Interface web responsiva (funciona em mobile e desktop)</li>
            <li>Comunicação via protocolo HTTP</li>
            <li>Armazenamento local de configurações</li>
            <li>Visualização de dados em tempo real</li>
            <li>Design moderno e intuitivo</li>
          </ul>

          <div class="developers">
            <h4>Desenvolvido por:</h4>
            <p><strong>Jalussiel e Jomarcio</strong></p>
            <p>Este projeto representa uma solução prática e acessível para automação residencial e controle inteligente de energia, combinando eletrônica, programação e design de interfaces para criar um sistema completo de IoT.</p>
          </div>
        </div>
      </div>

      <div id="configuracoes" class="section" style="display: none;">
        <h2>Configurações Avançadas</h2>
        <p>Opções avançadas de configuração...</p>
      </div>
    </div>
  </div>

  <script>
    // ===== VARIÁVEIS GLOBAIS =====
    let arduinoIP = localStorage.getItem('arduino_ip') || '';
    let lampadasEstado = [false, false, false, false]; // Estados das 4 lâmpadas

    // ===== FUNÇÕES DE NAVEGAÇÃO =====
    function showSection(sectionId) {
      // Oculta todas as seções
      document.querySelectorAll('.section').forEach(section => {
        section.style.display = 'none';
      });
      
      // Remove classe active de todos os itens do menu
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });
      
      // Mostra a seção selecionada e ativa o menu correspondente
      document.getElementById(sectionId).style.display = 'block';
      event.target.classList.add('active');
    }

    // ===== FUNÇÕES DE CONTROLE =====
    function toggleSwitch(element, lampadaId) {
      const index = lampadaId - 1;
      const novoEstado = !lampadasEstado[index];
      
      // Atualiza estado local
      lampadasEstado[index] = novoEstado;
      
      // Atualiza UI
      element.classList.toggle("on");
      const card = element.closest('.card');
      const status = card.querySelector('.status');

      if (novoEstado) {
        status.textContent = "ON";
        status.className = "status on";
      } else {
        status.textContent = "OFF";
        status.className = "status off";
      }
      
      // Envia comando para Arduino
      controlarLampada(lampadaId, novoEstado);
    }

    function controlarLampada(lampadaId, ligar) {
      if (!arduinoIP) {
        alert('Configure primeiro o IP do Arduino!');
        return;
      }
      
      const comando = ligar ? 'on' : 'off';
      // ✅ ENDPOINT COMPATÍVEL COM SEU ARDUINO
      const endpoint = `/lamp${lampadaId}=${comando}`;
      
      fetch(`http://${arduinoIP}${endpoint}`)
        .then(response => {
          if (response.ok) {
            console.log(`Lâmpada ${lampadaId} ${comando === 'on' ? 'ligada' : 'desligada'}`);
            lampadasEstado[lampadaId - 1] = ligar;
          } else {
            console.error('Erro na resposta do Arduino');
            // Reverte estado na UI em caso de erro
            setTimeout(() => {
              const toggle = document.querySelector(`.card:nth-child(${lampadaId}) .toggle`);
              const status = document.querySelector(`.card:nth-child(${lampadaId}) .status`);
              
              if (toggle) {
                toggle.classList.toggle('on');
                lampadasEstado[lampadaId - 1] = !ligar;
                
                if (status) {
                  status.textContent = ligar ? "OFF" : "ON";
                  status.className = ligar ? "status off" : "status on";
                }
              }
            }, 100);
          }
        })
        .catch(error => {
          console.error('Erro ao conectar com Arduino:', error);
          alert('Erro ao conectar com o Arduino. Verifique o IP e a conexão.');
          
          // Reverte estado na UI
          setTimeout(() => {
            const toggle = document.querySelector(`.card:nth-child(${lampadaId}) .toggle`);
            const status = document.querySelector(`.card:nth-child(${lampadaId}) .status`);
            
            if (toggle) {
              toggle.classList.toggle('on');
              lampadasEstado[lampadaId - 1] = !ligar;
              
              if (status) {
                status.textContent = ligar ? "OFF" : "ON";
                status.className = ligar ? "status off" : "status on";
              }
            }
          }, 100);
        });
    }

    function salvarIP() {
      const ipInput = document.getElementById('arduinoIP');
      const ip = ipInput.value.trim();
      
      if (!ip) {
        alert('Por favor, insira um IP válido.');
        return;
      }
      
      // Validação básica de IP
      const ipRegex = /^(\d{1,3}\.){3}\d{1,3}$/;
      if (!ipRegex.test(ip)) {
        alert('Por favor, insira um IP válido (ex: 192.168.1.77)');
        return;
      }
      
      arduinoIP = ip;
      localStorage.setItem('arduino_ip', ip);
      alert(`IP do Arduino salvo: ${ip}`);
    }

    // ===== INICIALIZAÇÃO =====
    document.addEventListener('DOMContentLoaded', function() {
      // Carrega IP salvo
      if (arduinoIP) {
        document.getElementById('arduinoIP').value = arduinoIP;
      }
      
      // Inicializa gráfico
      const ctx = document.getElementById('chart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Segunda', 'Terça', 'Quarta', 'Quinta', 'Sexta', 'Sábado', 'Domingo'],
          datasets: [{
            label: 'Consumo (W)',
            data: [12, 19, 8, 17, 14, 12, 7],
            borderColor: '#1976d2',
            backgroundColor: 'rgba(25, 118, 210, 0.1)',
            borderWidth: 2,
            tension: 0.4,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top'
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: {
                display: true,
                text: 'Watts (W)'
              }
            },
            x: {
              title: {
                display: true,
                text: 'Dias da Semana'
              }
            }
          }
        }
      });
    });
  </script>
</body>
  </html>
